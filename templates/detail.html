<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìƒì„¸ ì •ë³´</title>
  <!-- Flaskë¥¼ ìœ„í•´ ìˆ˜ì • (CSS ì—°ê²°)-->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="iphone-frame">
    <div class="dynamic-island">
      <div class="time" id="currentTime">12:00</div>
      <div class="island"></div>
      <div class="status-icons">
       <img src="{{ url_for('static', filename='doc.png') }}" alt="status icons" class="status-img">
      </div>
    </div>

    <div class="app-screen">
      <a href="{{ url_for('index') }}" class="logo-text-center">TripPick</a>

      <!-- ë’¤ë¡œê°€ê¸° ì´ë¯¸ì§€ -->
      <div class="back-section">
        <img src="{{ url_for('static', filename='back-arrow.png') }}" class="back-icon" onclick="history.back()" alt="back">
        <span class="page-title-left">ìƒì„¸ ì •ë³´</span>
      </div>

       <!-- ì—¬í–‰ì§€ ì œëª© -->
      <h2>{{ item.title }}</h2>

      <!-- ì—¬í–‰ì§€ ì´ë¯¸ì§€ -->
      {% if image_url %}
        <img src="{{ image_url }}" alt="{{ item.title }}" class="detail-image">
      {% elif item.firstimage %}
        <img src="{{ item.firstimage }}" alt="{{ item.title }}" class="detail-image">
      {% else %}
        <p>ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endif %}

      <!-- ìƒì„¸ ì„¤ëª… -->
      <h3>ì†Œê°œ</h3>
      <p>{{ item.overview | safe }}</p>

      <h3>ì£¼ì†Œ</h3>
      <p>{{ item.addr1 }}</p>

      <h3>ì§€ë„</h3>
      <a class="map-button"
        href="https://map.kakao.com/?q={{ item.title | urlencode }}"
        target="_blank">
       ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µ ìœ„ì¹˜ ë³´ê¸°
      </a>

      <!-- ë‚ ì”¨ ì •ë³´ -->
      <h3>í˜„ì¬ ë‚ ì”¨</h3>
      {% if weather and weather.current and not weather.current.error %}
        <p class="current-weather">
          {{ weather.current.weather_kr | weather_emoji }} {{ weather.current.weather_kr }} | {{ weather.current.temperature }}â„ƒ
        </p>
        <p class="section-timestamp">ê´€ì¸¡ ì‹œê°: {{ weather.current.time.strftime('%Y-%m-%d %H:%M') }}</p>
      {% else %}
       <p>ë‚ ì”¨ ì •ë³´ ì—†ìŒ</p>
      {% endif %}


      <h3>ì¼ë³„ ì˜ˆë³´</h3>
      {% if weather and weather.forecast and not weather.forecast[0].error %}
        <table class="forecast-table">
          <thead>
            <tr>
             <th>ë‚ ì§œ</th>
             <th>ë‚ ì”¨</th>
             <th>ìµœê³ ê¸°ì˜¨</th>
             <th>ìµœì €ê¸°ì˜¨</th>
            </tr>
          </thead>
          <tbody>
            {% for day in weather.forecast %}
              <tr>
               <td>{{ day.date.strftime('%m/%d') }}</td>
               <td>{{ day.weather_kr | weather_emoji }} {{ day.weather_kr }}</td>
               <td>{{ day.t_max }}â„ƒ</td>
               <td>{{ day.t_min }}â„ƒ</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
       <p>ì˜ˆë³´ ì—†ìŒ</p>
      {% endif %}


      <h3>íƒœê·¸</h3>
      {% if keywords %}
       <div class="tag-container">
         {% for tag in keywords[:3] %}
          <span class="tag">#{{ tag }}</span>
         {% endfor %}
       </div>
      {% endif %}


      <h3>ì´ ì§€ì—­ì˜ íŠ¹ì‚°ë¬¼ ëª©ë¡</h3>
       <ul>
         {% for it in items2 %}
           <li>{{ it.cntntsSj }}</li>
         {% endfor %}
       </ul>

      <h3>ë¦¬ë·°</h3>
      {% if session.get('user_id') %}
      <form action="{{ url_for('detail') }}?item_addr1={{ info.item_addr1 }}&contentid={{ info.contentid }}&image={{ info.image }}&title={{ info.title }}&tel={{ info.tel }}"
            method="post" enctype="multipart/form-data">
        <label for="title">ì œëª©:</label><br>
        <input type="text" id="title" name="title" required><br><br>
        <label for="content">ë‚´ìš©:</label><br>
        <textarea id="content" name="content" rows="3" required></textarea><br><br>
        <label for="theme">í…Œë§ˆ:</label><br>
        <select id="theme" name="theme">
          <option value="íë§">íë§</option>
          <option value="ì•¡í‹°ë¹„í‹°">ì•¡í‹°ë¹„í‹°</option>
          <option value="ì‚¬ì§„ëª…ì†Œ">ì‚¬ì§„ëª…ì†Œ</option>
          <option value="ë¨¹ê±°ë¦¬">ë¨¹ê±°ë¦¬</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select><br><br>
        <label for="image">ì‚¬ì§„ ì²¨ë¶€:</label><br>
        <input type="file" id="image" name="image" accept="image/*"><br><br>
        <button type="submit">ë¦¬ë·° ì‘ì„±</button>
      </form>
      {% else %}
      <p>ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”. <a href="{{ url_for('login') }}">ë¡œê·¸ì¸</a></p>
      {% endif %}

      {% if reviews %}
      <ul class="place-review-list">
        {% for review in reviews %}
          <li class="place-review-item">
            <h4>{{ review.title }}</h4>
            <p>{{ review.content }}</p>
            <p>ì‘ì„±ì: {{ review.user }} | {{ review.timestamp }}</p>
            <a href="{{ url_for('review_detail', review_id=review.doc_id) }}">ë¦¬ë·° ìƒì„¸</a>
          </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>ì•„ì§ ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endif %}

      <!-- ì¶”ê°€ ì •ë³´ê°€ ìˆë‹¤ë©´ í‘œì‹œ -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <script>
            alert("{{ messages[-1] }}");
          </script>
        {% endif %}
      {% endwith %}


      <!-- Flask ì—°ë™ -->
      <a href="{{ url_for('index') }}" class="app">í™ˆìœ¼ë¡œ</a>
      <!-- <button class="app" onclick="navigate('index.html')">í™ˆìœ¼ë¡œ</button> -->
    </div>

    <div class="home-indicator"></div>
  </div>

  <script>
    function navigate(page) {
      window.location.href = page;
    }
    function updateTime() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      document.getElementById('currentTime').textContent = `${hours}:${minutes}`;
    }
    setInterval(updateTime, 1000);
    updateTime();
  </script>

  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_api_key }}&libraries=services"></script>
  <script>
    const container = document.getElementById('map');
    const options = {
      center: new kakao.maps.LatLng({{ item.mapy }}, {{ item.mapx }}),
      level: 3
    };

    const map = new kakao.maps.Map(container, options);

    const marker = new kakao.maps.Marker({
      position: new kakao.maps.LatLng({{ item.mapy }}, {{ item.mapx }})
    });
    marker.setMap(map);

    const infowindow = new kakao.maps.InfoWindow({
      content: '<div style="padding:5px;font-size:14px;">{{ item.title }}</div>'
    });
    infowindow.open(map, marker);
  </script>
</body>
</html>
